name: ğŸ“¡ Dispatch to Backend
on:
  issue_comment:
    types: [created]

jobs:
  dispatch:
    # Added OWNER to the association check
    if: |
      contains(github.event.comment.body, '/approve') && 
      (github.event.comment.author_association == 'MEMBER' || github.event.comment.author_association == 'OWNER')
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“ Parse Issue Form
        uses: peter-murray/issue-forms-body-parser@v2
        id: parse
        with:
          issue_id: ${{ github.event.issue.number }}

      - name: ğŸš€ Send to Private Repo
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.CROSS_REPO_PAT }} 
          repository: your-org/private-automation-backend # Ensure this matches your actual org/repo name
          event-type: firewall-trigger
          client-payload: |
            {
              "issue_number": "${{ github.event.issue.number }}",
              "form_data": ${{ steps.parse.outputs.payload }},
              "requestor": "${{ github.event.issue.user.login }}"
            }
