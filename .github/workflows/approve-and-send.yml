name: ğŸ“¡ Dispatch to Backend
on:
  workflow_dispatch: # This adds a manual "Run" button in the Actions tab
  issue_comment:
    types: [created]

permissions:
  issues: read
  contents: read

jobs:
  dispatch:
    # Only run if someone comments /approve. 
    # Removed the author check temporarily to ensure it triggers for YOU.
    if: |
      contains(github.event.comment.body, '/approve') && 
      (github.event.comment.author_association == 'MEMBER' || github.event.comment.author_association == 'OWNER')
    runs-on: ubuntu-latest
    steps:
      - name: âœ… Connection Test
        run: echo "The workflow is alive and triggered by ${{ github.event_name }}"

      - name: ğŸ“ Parse Issue Form
        uses: peter-murray/issue-forms-body-parser@v2
        id: parse
        with:
          issue_id: ${{ github.event.issue.number }}

      - name: ğŸš€ Send to Private Repo
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.CROSS_REPO_PAT }} 
          repository: your-org/private-automation-backend
          event-type: firewall-trigger
          client-payload: |
            {
              "issue_number": "${{ github.event.issue.number }}",
              "form_data": ${{ steps.parse.outputs.payload }},
              "requestor": "${{ github.event.issue.user.login }}"
            }
